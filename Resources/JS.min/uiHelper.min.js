var UI=function(){this.container=$("#tempContainer")};UI.prototype.getDroppableOptions=function(){var a=this;return{activate:function(b,c){a.container.css({"border-width":"1px","border-style":"dashed","border-color":"black"})},deactivate:function(b,c){a.container.css({"border-width":"0px","border-style":"dashed","border-color":"black"})},drop:function(b,c){$("#sortToggle:hidden").toggle();var d=[];$.each(c.draggable.parents().prev("li"),function(){d.push($(this).text())});var e=d.reverse().join("|");e=e?"table_"+e:"table_root";var f,g=c.draggable.clone().children().remove().end().text(),h=$(this).find("li:containsExact("+g+")");if(h.length){f=h.eq(0);var i=f.find("span").eq(0);i.text(0==i.text()?"[1]":"["+(parseInt(i.text().replace(/\D/g,""))+1)+"]")}else f=$("<li/>",{text:c.draggable.text(),"class":"top_level",ref:e}),f.append($("<span/>")),f.append(window.queryBuilder.createQueryBuilderButtons()),$(this).append(f),$(this).switchClass("containerHover","containerNonHover",3e3,"easeInOutQuad");a.container=$("#tempContainer"),$("[ref='"+e+"']").toggle("highlight","slow").toggle("highlight","slow")},over:function(a,b){$(this).addClass("containerNonHover").switchClass("containerNonHover","containerHover",3e3,"easeInOutQuad")},out:function(a,b){$(this).switchClass("containerHover","containerNonHover",3e3,"easeInOutQuad")},tolerance:"pointer",accept:".regular-item"}},UI.prototype.getDraggableOptions=function(){return{revert:!0,cursor:"move",start:function(a,b){$(this).toggleClass("hovering-item")},stop:function(a,b){$(this).toggleClass("hovering-item")}}},UI.prototype.getSortableOptions=function(){return{placeholder:"ui-state-highlight"}},UI.prototype.draggableDroppableSortable=function(){var a=this;$(".regular-item").draggable(a.getDraggableOptions()),$("#tempContainer").droppable(a.getDroppableOptions()).sortable(a.getSortableOptions()),$("#sortable").disableSelection()},UI.prototype.toggleSorted=function(){return console.log(this.container),window.unsorted?(this.container=this.undoSorting(this.container),!1):(this.container=this.sort(this.container),!0)},UI.prototype.sort=function(a){window.unsorted=a.clone(),window.unsorted.attr("id","clonedTemp");var b={};$.each(this.container.find("li[ref]"),function(){var a=$(this).attr("ref").replace("table_","");void 0===b[a]&&(b[a]=[]),b[a].push($(this))}),a.empty();var c=this;return $.each(b,function(b,d){var e=$("<code/>",{text:b}),f=$("<li/>",{"class":"top_level"});f.append(e),a.append(f);var g=$("<ul/>");$.each(d,function(a,b){g.append(b),b.switchClass("top_level","temp_sub_item",2e3),b.children("div").detach(),b.append(window.queryBuilder.createQueryBuilderButtons(!1,!0))}),a.find("ul").sortable(c.getSortableOptions()).droppable(c.getDroppableOptions()),a.append(g)}),a},UI.prototype.undoSorting=function(a){var b=window.unsorted.clone().prop("id",a.prop("id"));return a.replaceWith(b),b.sortable(this.getSortableOptions()).droppable(this.getDroppableOptions()),window.unsorted=null,b},UI.prototype.reset=function(){this.container.empty(),window.unsorted=null};